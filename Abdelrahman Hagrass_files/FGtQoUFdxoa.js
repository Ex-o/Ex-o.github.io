/*!CK:1073674445!*//*1447755748,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["rsbfp"]); }

__d("XFeedUFICommentsController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/feed\/ufi\/",{fs:{type:"Int"},feedback_target:{type:"String",required:true},focus_composer:{type:"Bool",defaultValue:false},replace_id:{type:"String",required:true},share_id:{type:"String"},link_data:{type:"String"},action_source:{type:"Int"}});},null,{});
__d("XFeedUFICommentHistoryController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/feed\/ufi\/{comment_token}\/history\/",{comment_token:{type:"String",required:true},replace_id:{type:"String",required:true}});},null,{});
__d("XFeedUFILikesController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/feed\/ufi\/likes\/",{feedback_target:{type:"String",required:true},replace_id:{type:"String",required:true},link_data:{type:"String"}});},null,{});
__d("XFeedUFIReactionsController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/feed\/ufi\/reactions\/",{feedback_target:{type:"String",required:true},replace_id:{type:"String",required:true},link_data:{type:"String"}});},null,{});
__d('MFeedUFI',['$','ActorURI','CSS','DataStore','DOM','MParent','MJSEnvironment','MRequest','MViewport','Stratcom','Vector','XFeedUFICommentsController','XFeedUFICommentHistoryController','XFeedUFILikesController','XFeedUFIReactionsController','cx','ge','getActiveElement','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){if(c.__markCompiled)c.__markCompiled();var aa='feed-ufi',ba={COMMENTS:'comments',LIKES:'likes',REACTIONS:'reactions',HISTORY:'history',NONE:''},ca,da,ea,fa,ga,ha,ia,ja,ka,la=null,ma=null;function na(){if(ha)return;ia=[q.listen('click',[aa,'composer-submit'],kb),q.listen('click','like',hb),q.listen('focus',[aa,'textarea'],fb),q.listen('multi-photos-change',null,lb),q.listen('MCommentEdit:showcomposer',null,mb),q.listen('m:page:unload',null,sa)];if(n.IS_APPLE_WEBKIT_IOS)ia.push(q.listen('focus',[aa,'editCommentTextArea'],gb));ha=true;}function oa(){if(!ga)return;l.find(ga,'*','textarea').blur();}function pa(){if(!ga)return;l.find(ga,'*','textarea').focus();}function qa(){if(!ga)return;var ub=l.find(ga,'*','textarea');if(y()===ub)p.scrollTo(0,r.getPos(ub).y+ub.offsetHeight-p.getScreenHeight());}function ra(){if(!ka)ka=l.scry(document,'div',aa)[0];return ka;}function sa(){while(ia.length)ia.pop().remove();ta();wa();ca=null;da=null;ea=null;ka=null;ha=false;}function ta(){if(!la)return;while(la.length)la.pop().remove();la=null;}function ua(ub,vb,wb){va(wb);var xb=sb(ub);qb(false);if(xb===ca){if(vb)pa();rb(ba.COMMENTS);q.invoke('m:feed-ufi-flyout:comments-displayed');return;}ca=xb;var yb=l.find(ra(),'div','feed-ufi-comments').id,zb=s.getURIBuilder().setString('feedback_target',xb).setString('replace_id',yb).setBool('focus_composer',!!vb),ac=k.get(ub).feedback_source;if(ac)zb.setInt('fs',ac);var bc=k.get(ub).share_id;if(bc)zb.setString('share_id',bc.toString());var cc=k.get(ub).action_source;if(cc===undefined)cc=20;var dc=tb(ub);if(dc)zb.setString('link_data',dc);zb=zb.getURI();var ec=k.get(ub).actor_id;if(ec)zb=i.create(zb,ec);ja=new o(zb.toString());ja.listen('finally',function(){ja=null;});ja.send();}function va(ub){wa();if(ub)ma=q.listen('m:feed-ufi-flyout:comments-displayed',null,function(){setTimeout(function(){var vb=x(ub+'');if(vb&&fa&&fa.contains(vb))pb(vb.offsetTop);});wa();});}function wa(){if(ma){ma.remove();ma=null;}}function xa(ub){var vb=sb(ub);qb(true);if(vb===da){rb(ba.LIKES);return;}da=vb;rb(ba.NONE);var wb=l.find(ra(),'div','feed-ufi-likes').id,xb=u.getURIBuilder().setString('feedback_target',vb).setString('replace_id',wb).getURI();ja=new o(xb.toString());ja.listen('finally',function(){ja=null;});ja.send();}function ya(ub){var vb=sb(ub);qb(true);if(vb===ea){rb(ba.REACTIONS);return;}ea=vb;rb(ba.NONE);var wb=l.find(ra(),'div','feed-ufi-reactions').id,xb=v.getURIBuilder().setString('feedback_target',vb).setString('replace_id',wb).getURI();ja=new o(xb.toString());ja.listen('finally',function(){ja=null;});ja.send();}function za(ub){qb(true);rb(ba.NONE);var vb=l.find(ra(),'div','feed-ufi-comment-history').id,wb=t.getURIBuilder().setString('comment_token',ub).setString('replace_id',vb).getURI();ja=new o(wb.toString());ja.listen('finally',function(){ja=null;});ja.send();}function ab(){rb(ba.HISTORY);}function bb(){if(!ja)return;ca=null;da=null;ja.abort();ja=null;}function cb(){ca=null;da=null;}function db(ub){var vb=sb(ub),wb=vb!==ca;rb(wb?ba.NONE:ba.COMMENTS);if(wb)q.invoke('m:feed-ufi-flyout:reset',null,{target_id:vb});}function eb(ub,vb){rb(ba.COMMENTS);fa=ub;ga=vb;q.invoke('m:feed-ufi-flyout:comments-displayed');}function fb(){q.invoke('click','edit-link');}function gb(ub){if(la)return;var vb=ub.getTarget();la=[q.listen('MScrollArea:scrollend',null,function(){var wb=vb.selectionStart,xb=vb.selectionEnd;vb.setSelectionRange(Math.abs(wb-1),Math.abs(xb-1));vb.setSelectionRange(wb,xb);}),q.listen('blur',[aa,'editCommentTextArea'],function(){ta();})];}function hb(){da=null;}function ib(ub){rb(ba.LIKES);}function jb(ub){rb(ba.REACTIONS);}function kb(){var ub=ra();z(function(){var vb=l.find(ub,'div','feed-ufi-composer-placeholder');pb(vb.offsetTop);},0);j.conditionClass(l.find(ub,'div','feed-ufi-comments'),"_5jc2",true);}function lb(){if(!ga)return;var ub=ra();if(ub)j.conditionClass(ra(),"_5rpd",l.scry(ga,'input','m-multi-photos-photo').length);}function mb(ub){pb(ub.getData().composer.offsetTop);}function nb(ub){q.invoke('m:feed-ufi-flyout:comment-change');pb(h(ub).offsetTop);}function ob(){q.invoke('m:feed-ufi-flyout:comment-change');var ub=ra();if(l.scry(ub,'div','comment').length){k.get(fa).scrollArea.reflow();}else j.conditionClass(l.find(ub,'div','feed-ufi-comments'),"_5jc2",false);}function pb(ub){if(!fa)return;var vb=k.get(fa).scrollArea;vb.reflow();z(function(){var wb=vb.getMaxScrollTop();if(ub!==undefined)wb=Math.min(ub,wb);vb.scrollTo(0,wb);},100);}function qb(ub){var vb=ra();if(vb)j.conditionClass(vb,"_5sd3",ub);}function rb(ub){var vb=ra();if(vb){j.conditionClass(vb,"_5m_y",ub==ba.COMMENTS);j.conditionClass(vb,"_5m_z",ub==ba.LIKES);j.conditionClass(vb,"_3b5-",ub==ba.REACTIONS);j.conditionClass(vb,"_5ugy",ub==ba.HISTORY);}}function sb(ub){return k.get(ub).feedback_target.toString();}function tb(ub){var vb=m.bySigil(ub,'story-div');if(!vb)return;var wb=k.get(vb).linkdata;if(wb)return wb.toString();return null;}g.blur=oa;g.cancel=bb;g.clearCache=cb;g.focus=pa;g.getRoot=ra;g.init=na;g.loadComments=ua;g.loadLikes=xa;g.loadReactions=ya;g.loadCommentHistory=za;g.onCommentHistoryLoad=ab;g.onCommentAdded=nb;g.onCommentRemoved=ob;g.onCommentsLoad=eb;g.onLikesLoad=ib;g.onReactionsLoad=jb;g.reset=db;g.scrollTo=qa;},null);
__d('MCommentEdit',['$','cx','ge','CSS','DataStore','DOM','MRequest','Stratcom','URI'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=[];function r(da){m.hide(h(da));}function s(da){var ea=document.getElementById('photo-composer-'+da);if(ea==null)ea=document.getElementById('composer-'+da);return ea;}function t(da){var ea=s(da);ea&&m.hide(ea);}function u(da){var ea=s(da);ea&&m.show(ea);}function v(da,ea,fa){q.push(m.listen(h(da),'click',null,function(ga){y(ea,fa);this.remove();}));}function w(da,ea){function fa(){var ga=da.querySelector('textarea').value,ha=ga.length===0;ea.disabled=ha;k.conditionClass(ea,"_56bt",ha);k.conditionClass(ea,"_56bu",!ha);}fa();q.push(m.listen(da,'keyup',null,fa));}function x(da){q.push(o.listen('click','edit-link',function(ea){var fa=document.getElementById(da);ca(da);if(fa)m.show(fa);this.remove();}));}function y(da,ea){m.show(h(da));u(ea);ca(da);}var z;function aa(da){da.kill();var ea=l.get(da.getTarget());new n(new p(ea.deleteUri)).send();}function ba(da){if(!z)z=o.listen('click','comment-edit-delete-link',aa);r(da.domContainerId);t(da.entId);o.invoke('MCommentEdit:showcomposer',null,{composer:document.getElementById(da.commentComposerId),entId:da.entId,domContainerId:da.domContainerId});}function ca(da){var ea=j('commentEditComposer'+da);if(ea)m.remove(ea);for(var fa=0;fa<q.length;fa++)q[fa].remove();q=[];}g.showComposer=u;g.showCommentEditor=ba;g.removeEditComposer=ca;g.listenForCancel=v;g.listenForEmptyInput=w;g.listenForOtherEdit=x;g.cancelEdit=y;},null);
__d('MFeedUFIOverlay',['DataStore','MFeedUFI','MHistory','MJSEnvironment','MParent','MViewport','MScrollPositionSaver','MCommentEdit','Stratcom','URI','getActiveElement'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s='feed_ufi',t='comment_token',u='comments',v='likes',w='reactions',x='comment-history',y='nfx',z=k.IS_ANDROID&&!k.IS_FIREFOX&&!k.IS_CHROME,aa,ba,ca,da=[],ea,fa,ga,ha,ia,ja={};function ka(gb){aa=gb;ca=[aa.addListener('beforeshow',pa),aa.addListener('hide',qa),aa.addListener('show',sa),p.listen('click','m-overlay-modal',ra),p.listen('click','feed-ufi-trigger',ab),p.listen('click','feed-ufi-back',ua),p.listen('click','feed-ufi-done',va),p.listen('click','feed-ufi-likers',cb),p.listen('click','feed-ufi-reactors',db),p.listen('click','feed-ufi-view-history',fb),p.listen('click','feed-ufi-nfx-dialog',bb),p.listen('m:history:change',null,ta),p.listen('m:page:unload',null,la),p.listen('MCommentEdit:showcomposer',null,function(hb){ja.domContainerId=hb.getData().domContainerId;ja.entId=hb.getData().entId;})];ba=new q(j.getPath()).addQueryData(s,undefined).addQueryData(t,undefined).toString();j.replaceState(ba);}function la(){while(ca.length)ca.pop().remove();ma();}function ma(){while(da.length)da.pop().remove();}function na(){if(oa()===u){history.go(-1);}else history.go(-2);}function oa(){return j.getParam(s);}function pa(){i.reset(ha);xa();ya();}function qa(){if(typeof ja.domContainerId!=='undefined'&&typeof ja.entId!=='undefined')o.cancelEdit(ja.domContainerId,ja.entId);clearTimeout(ga);i.cancel();i.blur();r().blur();ma();n.setScrollPosition(ea);p.invoke('m:feed-ufi:hide',null,null);}function ra(gb){if(gb.getNode('m-layer-root')===aa.getRoot()&&aa.isShown())if(aa.getUpdatePositionBlocked()){i.blur();}else na();}function sa(){if(da.length===0)da=[p.listen('scroll',null,za),p.listen('m:viewport:orientation-change',null,wa)];p.invoke('m:feed-ufi:show',null,null);}function ta(gb){var hb=oa();if(hb){gb.prevent();if(!aa.isShown())aa.show();if(hb===u){i.loadComments(ha,false,ia);ia=null;}else if(hb===v){i.loadLikes(ha);}else if(hb===w){i.loadReactions(ha);}else if(hb===x){var ib=j.getParam(t);i.loadCommentHistory(ib);}else if(hb===y)qa();}else if(gb.getData().path!==ba){return;}else{gb.prevent();if(aa.isShown()){i.blur();aa.hide();}}}function ua(gb){gb.prevent();history.go(-1);}function va(gb){gb.prevent();na();}function wa(gb){if(!z){i.blur();m.scrollTo(0,fa);}else{clearTimeout(ga);ga=setTimeout(function(){i.scrollTo();},500);}}function xa(){fa=m.getScrollTop();}function ya(){ea=n.getScrollPosition();}function za(gb){if(!m.getScrollTop()&&fa)na();}function ab(gb){var hb=gb.getNode('feed-ufi-trigger');if(l.bySigil(hb,'disable-feed-ufi-triggers'))return;aa.setCausalElement(hb);h.get(hb).overlay=aa;ha=l.bySigil(hb,'feed-ufi-metadata');ia=h.get(hb).comment_id;ba=j.getPath();eb(u);gb.prevent();}function bb(gb){eb(y);gb.prevent();}function cb(gb){eb(v);gb.prevent();}function db(gb){eb(w);gb.prevent();}function eb(gb){j.pushState(new q(j.getPath()).addQueryData(s,gb).removeQueryData(t).toString());}function fb(gb){var hb=h.get(gb.getNode('comment')).token;j.pushState(new q(j.getPath()).addQueryData(s,x).addQueryData(t,hb).toString());gb.prevent();}g.init=ka;},null);
__d('MCurationOneClickButton',['CSS','DOM','DataStore','MRequest','SaveState','SaveStateHandler','Stratcom','cx','destroyOnUnload'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q='curation-one-click-save-button',r='curation-one-click-unsave-button',s='MCurationOneClickButton_instance',t="_5qgu",u="_5qgv",v=null;function w(x,y,z,aa,ba,ca,da){'use strict';this.$MCurationOneClickButton1=x;this.$MCurationOneClickButton2=z;this.$MCurationOneClickButton3=aa;this.$MCurationOneClickButton4=ba;this.$MCurationOneClickButton5=ca;this.$MCurationOneClickButton6=false;this.$MCurationOneClickButton7(this.$MCurationOneClickButton1,q);this.$MCurationOneClickButton7(this.$MCurationOneClickButton1,r);w.$MCurationOneClickButton8();m.listen(y,(function(ea){switch(ea){case l.SAVING:h.removeClass(x,t);h.addClass(x,u);this.$MCurationOneClickButton6=true;break;case l.SAVED:h.removeClass(x,t);h.removeClass(x,u);this.$MCurationOneClickButton6=false;break;case l.UNSAVING:h.addClass(x,t);h.addClass(x,u);this.$MCurationOneClickButton6=true;break;case l.UNSAVED:h.addClass(x,t);h.removeClass(x,u);this.$MCurationOneClickButton6=false;break;}}).bind(this));}w.prototype.$MCurationOneClickButton7=function(x,y){'use strict';var z={};z[s]=this;var aa=i.find(x,'*',y);j.set(aa,z);};w.prototype.$MCurationOneClickButton9=function(){'use strict';this.$MCurationOneClickButton10();if(!this.$MCurationOneClickButton6){this.$MCurationOneClickButton11(this.$MCurationOneClickButton3,(function(){m.unsaved(this.$MCurationOneClickButton2);}).bind(this));m.saving(this.$MCurationOneClickButton2);}};w.prototype.$MCurationOneClickButton12=function(){'use strict';this.$MCurationOneClickButton10();if(!this.$MCurationOneClickButton6){this.$MCurationOneClickButton11(this.$MCurationOneClickButton4,(function(){m.saved(this.$MCurationOneClickButton2);}).bind(this));m.unsaving(this.$MCurationOneClickButton2);}};w.prototype.$MCurationOneClickButton11=function(x,y){'use strict';var z=new k(x);z.listen('error',y);z.send();};w.prototype.$MCurationOneClickButton10=function(){'use strict';this.$MCurationOneClickButton5&&this.$MCurationOneClickButton5.disableNux();};w.handleSave=function(x){'use strict';var y=j.get(x)[s];y&&y.$MCurationOneClickButton9();};w.handleUnsave=function(x){'use strict';var y=j.get(x)[s];y&&y.$MCurationOneClickButton12();};w.$MCurationOneClickButton8=function(){'use strict';if(v)return null;v=[n.listen('click',q,function(x){w.handleSave(x.getNode(q));}),n.listen('click',r,function(x){w.handleUnsave(x.getNode(r));})];p(function(){while(v.length)v.pop().remove();v=null;});};f.exports=w;},null);
__d('MOverlay',['setTimeoutAcrossTransitions','cx','ge','CSS','DOM','Locale','MLayer','MJSEnvironment','MViewport','Scroll','Stratcom','MTouchHelper'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t,u,v=28,w=10,x='m-overlay-layer',y=[x,'tag:textarea'];t=babelHelpers.inherits(z,n);u=t&&t.prototype;function z(aa,ba){'use strict';u.constructor.call(this,aa);this.$MOverlay1=null;this.shownListeners=null;this.init(ba);}z.prototype.buildWrapper=function(aa,ba){'use strict';this.$MOverlay2=l.create('div',{className:"_5m_s"});var ca=l.create('div',{className:"_5m_t"},ba);this.$MOverlay3=l.create('div',{className:"_5m_u"},[this.$MOverlay2,ca]);if(m.isRTL())this.$MOverlay3.style.direction='rtl';this.$MOverlay4=l.create('div',{className:"_5m_v",sigil:x},this.$MOverlay3);var da=l.create('div',{className:"_5m_w",sigil:'m-overlay-modal blocking-touchable'});return l.create('div',{className:"_5m_x"},[this.$MOverlay4,da]);};z.prototype.getContentRoot=function(){'use strict';return this.$MOverlay3;};z.prototype.show=function(){'use strict';if(this.isShown())return this;u.show.call(this);if(this.isShown()&&!this.shownListeners){this.shownListeners=[r.listen('touchstart',y,this.$MOverlay5.bind(this)),r.listen('touchend',y,this.$MOverlay6.bind(this)),r.listen('m:viewport:orientation-change',null,this.updatePosition.bind(this)),r.listen('focus',y,this.onFocus.bind(this)),r.listen('blur',y,this.onBlur.bind(this))];if(!this.config.suppressScrollHandler)this.shownListeners.push(r.listen('scroll',null,this.onScroll.bind(this)));if(!this.config.suppressTouchMoveHandler)this.shownListeners.push(r.listen('touchmove',x,this.onTouchMove.bind(this)));}return this;};z.prototype.finishHide=function(){'use strict';while(this.shownListeners&&this.shownListeners.length)this.shownListeners.pop().remove();this.shownListeners=null;this.$MOverlay1=null;clearTimeout(this.$MOverlay7);clearInterval(this.$MOverlay8);this.$MOverlay7=null;this.$MOverlay8=null;return u.finishHide.call(this);};z.prototype.updatePosition=function(){'use strict';if(this.$MOverlay9)return;clearInterval(this.$MOverlay8);this.$MOverlay8=null;this.$MOverlay3.style.height=this.getHeight()+'px';this.getRoot().style.top=this.getTop()+'px';clearTimeout(this.$MOverlay10);this.$MOverlay10=null;};z.prototype.getTop=function(){'use strict';return p.getScrollTop();};z.prototype.getHeight=function(){'use strict';var aa=p.getHeight(),ba=v;if(o.IS_APPLE_WEBKIT_IOS&&o.OS_VERSION===7){var ca=p.isLandscape()?screen.availWidth:screen.availHeight,da=ca-aa<=19;ba=da?44:10;if(da)this.$MOverlay8=setInterval((function(){var ea=p.getHeight();if(ea!==aa){clearInterval(this.$MOverlay8);this.$MOverlay8=null;setTimeout(this.updatePosition.bind(this),100);}}).bind(this),500);k.conditionClass(this.getRoot(),"_5rpc",!da);}return aa-w-ba;};z.prototype.onTouchMove=function(aa){'use strict';if(!aa.getNode('tag:textarea')||this.$MOverlay1===null){aa.prevent();}else{var ba=aa.getTarget(),ca=s.getTouchClientCoord(aa).y,da=this.$MOverlay1-ca,ea=ba.scrollHeight-ba.offsetHeight;if(ea<=0||da<0&&q.getTop(ba)<=0||da>0&&q.getTop(ba)>=ea){aa.prevent();}else aa.stop();}};z.prototype.$MOverlay5=function(aa){'use strict';this.$MOverlay1=s.getTouchClientCoord(aa).y;};z.prototype.$MOverlay6=function(aa){'use strict';this.$MOverlay1=null;};z.prototype.onScroll=function(aa){'use strict';clearTimeout(this.$MOverlay10);this.$MOverlay10=h(this.updatePosition.bind(this),100);};z.prototype.onFocus=function(aa){'use strict';this.$MOverlay9=true;};z.prototype.onBlur=function(aa){'use strict';this.$MOverlay9=false;this.updatePosition();this.$MOverlay7=h(this.updatePosition.bind(this),1000);};z.prototype.getUpdatePositionBlocked=function(){'use strict';return this.$MOverlay9;};z.prototype.getInsertParent=function(){'use strict';var aa=this.insertParent;if(!aa)aa=j('page');return aa||u.getInsertParent.call(this);};f.exports=z;},null);